name: Install/Upgrade ArgoCD
run-name: ${{ github.actor }} Install/Upgrade ArgoCD
on: [push]
jobs:
  install-argocd:
    runs-on: arc-runner-set

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      # - name: Install Helm
      #   run: |
      #     curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
      #     helm version

      # - name: Add ArgoCD repo
      #   run: |
      #     helm repo add argo https://argoproj.github.io/argo-helm
      #     helm repo update

      # - name: Install ArgoCD via Helm
      #   run: |
      #     helm upgrade --install argocd argo/argo-cd \
      #       --namespace argocd \
      #       --create-namespace \
      #       -f argocd-values.yaml \
      #       --wait

      - uses: azure/setup-kubectl@v4
        id: install

      - name: Apply ArgoCD manifest
        run: |
          kubectl apply -f argocd-ApplicationSet.yaml -n argocd
