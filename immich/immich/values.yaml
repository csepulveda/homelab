immich:
  server:
    ingress:
      main:
        enabled: true
        annotations:
          cert-manager.io/cluster-issuer: letsencrypt
          external-dns.alpha.kubernetes.io/target: router.csepulveda.net
          nginx.ingress.kubernetes.io/proxy-body-size: "0"
        hosts:
          - host: immich.csepulveda.net
            paths:
              - path: "/"
        tls:
          - hosts:
            - immich.csepulveda.net
            secretName: immich.csepulveda.net-tls
  machine-learning:
    enabled: true
    replicas: null
    image:
      repository: ghcr.io/immich-app/immich-machine-learning
      pullPolicy: IfNotPresent
    env:
      TRANSFORMERS_CACHE: /cache
      MACHINE_LEARNING_HTTP_KEEPALIVE_TIMEOUT_S: 0
    persistence:
      cache:
        enabled: true
        size: 10Gi
        type: emptyDir
        accessMode: ReadWriteMany
    resources:
      requests:
        cpu: "300m"
        memory: "256Mi" 

  image:
    tag: v1.135.3
  immich:
    metrics:
      enabled: true
    persistence:
      library:
        existingClaim: immich
  redis:
    enabled: true

  env:
    - name: IMMICH_TELEMETRY_INCLUDE
      value: all
    - name: IMMICH_API_METRICS_PORT
      value: 8081
    - name: IMMICH_MICROSERVICES_METRICS_PORT
      value: 8082
    - name: IMMICH_METRICS
      value: true
    - name: REDIS_HOSTNAME
      value: immich-redis-master
    - name: DB_HOSTNAME
      value: immich-postgresql
    - name: DB_DATABASE_NAME
      value: postgres
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: immich-postgresql
          key: superuser-password
    - name: DB_USERNAME
      valueFrom:
        secretKeyRef:
          name: immich-postgresql
          key: superuser-username
